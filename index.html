<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe de Consejo de Coordinación Misional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #333;
            line-height: 1.6;
            padding: 15px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 15px 0;
            margin-bottom: 20px;
            background: linear-gradient(to right, #1a2980, #26d0ce);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }
        
        header p {
            font-size: 1rem;
            opacity: 0.9;
            padding: 0 10px;
        }
        
        .form-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .form-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .form-section:last-child {
            border-bottom: none;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: #1a2980;
            font-size: 1.3rem;
        }
        
        .section-title i {
            margin-right: 10px;
            background: #26d0ce;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #444;
            font-size: 0.95rem;
        }
        
        input[type="date"], input[type="text"], input[type="number"], textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #26d0ce;
            box-shadow: 0 0 0 3px rgba(38, 208, 206, 0.2);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .personas-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .persona-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #26d0ce;
        }
        
        .persona-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .persona-header h4 {
            color: #1a2980;
            font-size: 1.1rem;
        }
        
        .remove-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .remove-btn:hover {
            background: #ff5252;
            transform: scale(1.1);
        }
        
        .add-btn {
            background: #26d0ce;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            margin-top: 10px;
            font-size: 0.95rem;
        }
        
        .add-btn:hover {
            background: #1a2980;
            transform: translateY(-2px);
        }
        
        .help-section {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #e8f4f8;
            border-radius: 8px;
        }
        
        .help-section.active {
            display: block;
        }
        
        .actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 25px;
        }
        
        .generate-btn, .clear-btn {
            padding: 12px 25px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .generate-btn {
            background: linear-gradient(to right, #1a2980, #26d0ce);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(26, 41, 128, 0.3);
        }
        
        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(26, 41, 128, 0.4);
        }
        
        .clear-btn {
            background: #f8f9fa;
            color: #444;
            border: 1px solid #ddd;
        }
        
        .clear-btn:hover {
            background: #e9ecef;
            transform: translateY(-3px);
        }
        
        .preview-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        
        .preview-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #26d0ce;
        }
        
        .preview-header h2 {
            color: #1a2980;
            margin-bottom: 10px;
            font-size: 1.6rem;
        }
        
        .preview-section {
            margin-bottom: 25px;
        }
        
        .preview-section h3 {
            color: #26d0ce;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            font-size: 1.2rem;
        }
        
        .preview-item {
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .preview-item h4 {
            color: #1a2980;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .preview-footer {
            text-align: center;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            color: #777;
            font-size: 0.9rem;
        }
        
        /* Estilos para móviles */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 0;
            }
            
            header {
                padding: 12px 10px;
                margin-bottom: 15px;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            header p {
                font-size: 0.9rem;
            }
            
            .form-container, .preview-container {
                padding: 15px;
            }
            
            .section-title {
                font-size: 1.2rem;
            }
            
            .section-title i {
                width: 32px;
                height: 32px;
                font-size: 0.8rem;
            }
            
            .persona-header h4 {
                font-size: 1rem;
            }
            
            .add-btn, .generate-btn, .clear-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .actions {
                flex-direction: column;
                align-items: center;
            }
            
            .actions button {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            header h1 {
                font-size: 1.3rem;
            }
            
            .section-title {
                font-size: 1.1rem;
            }
            
            .persona-header h4 {
                font-size: 0.95rem;
            }
            
            label {
                font-size: 0.9rem;
            }
            
            input[type="date"], input[type="text"], input[type="number"], textarea, select {
                font-size: 0.95rem;
                padding: 10px 12px;
            }
        }
        
        .save-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .save-btn:hover {
            background: #45a049;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-file-alt"></i> Informe de Consejo de Coordinación Misional</h1>
            <p>Complete el formulario para generar un informe detallado de las actividades misionales</p>
        </header>
        
        <div class="form-container">
            <form id="informeForm">
                <!-- Fecha -->
                <div class="form-group">
                    <label for="fecha"><i class="fas fa-calendar-alt"></i> Fecha</label>
                    <input type="date" id="fecha" name="fecha" required>
                </div>
                
                <!-- Persona[s]/Familia[s] en enseñanza -->
                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <h2>Persona[s]/Familia[s] en enseñanza</h2>
                    </div>
                    
                    <div class="personas-container" id="personasEnsenanza">
                        <div class="persona-item">
                            <div class="persona-header">
                                <h4>Persona/Familia #1</h4>
                                <button type="button" class="remove-btn" onclick="removePersona(this)"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="form-group">
                                <label>Nombre de la persona o familia</label>
                                <input type="text" name="personaNombre[]" placeholder="Ingrese nombre completo" required>
                            </div>
                            <div class="form-group">
                                <label>Edad (si aplica)</label>
                                <input type="number" name="personaEdad[]" min="0" max="120" placeholder="Ingrese edad">
                            </div>
                            <div class="form-group">
                                <label>Planes para ayudar a la persona/familia</label>
                                <textarea name="personaPlanes[]" placeholder="Describa los planes de apoyo..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" class="add-btn" onclick="addPersona('personasEnsenanza')">
                        <i class="fas fa-plus"></i> Agregar persona
                    </button>
                </div>
                
                <!-- Recién conversos -->
                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-user-plus"></i>
                        <h2>Recién conversos</h2>
                    </div>
                    
                    <div class="personas-container" id="recienConversos">
                        <div class="persona-item">
                            <div class="persona-header">
                                <h4>Recién convertido #1</h4>
                                <button type="button" class="remove-btn" onclick="removePersona(this)"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="form-group">
                                <label>Nombre de la persona o familia</label>
                                <input type="text" name="recienNombre[]" placeholder="Ingrese nombre completo" required>
                            </div>
                            <div class="form-group">
                                <label>Edad (si aplica)</label>
                                <input type="number" name="recienEdad[]" min="0" max="120" placeholder="Ingrese edad">
                            </div>
                            <div class="form-group">
                                <label>Planes para ayudar a la persona/familia</label>
                                <textarea name="recienPlanes[]" placeholder="Describa los planes de apoyo..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" class="add-btn" onclick="addPersona('recienConversos')">
                        <i class="fas fa-plus"></i> Agregar recién convertido
                    </button>
                </div>
                
                <!-- Menos Activos -->
                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-user-clock"></i>
                        <h2>Menos Activos</h2>
                    </div>
                    
                    <div class="personas-container" id="menosActivos">
                        <div class="persona-item">
                            <div class="persona-header">
                                <h4>Menos activo #1</h4>
                                <button type="button" class="remove-btn" onclick="removePersona(this)"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="form-group">
                                <label>Nombre de la persona o familia</label>
                                <input type="text" name="activoNombre[]" placeholder="Ingrese nombre completo" required>
                            </div>
                            <div class="form-group">
                                <label>Edad (si aplica)</label>
                                <input type="number" name="activoEdad[]" min="0" max="120" placeholder="Ingrese edad">
                            </div>
                            <div class="form-group">
                                <label>Planes para ayudar a la persona/familia</label>
                                <textarea name="activoPlanes[]" placeholder="Describa los planes de apoyo..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" class="add-btn" onclick="addPersona('menosActivos')">
                        <i class="fas fa-plus"></i> Agregar menos activo
                    </button>
                </div>
                
                <!-- Ayuda adicional necesaria -->
                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-hands-helping"></i>
                        <h2>Ayuda adicional necesaria</h2>
                    </div>
                    
                    <div class="form-group">
                        <label for="organizacion"><i class="fas fa-building"></i> Seleccionar organización</label>
                        <select id="organizacion" name="organizacion" onchange="toggleSubcategoria()">
                            <option value="">Seleccione una organización</option>
                            <option value="primaria">Primaria: 8 - 11</option>
                            <option value="jovenes">Hombres y Mujeres Jóvenes: 12 - 17</option>
                            <option value="sociedad">Sociedad de Socorro: 18+</option>
                            <option value="cuorum">Cuórum de Elderes: 18+</option>
                        </select>
                    </div>
                    
                    <div class="form-group help-section" id="subcategoriaJovenes">
                        <label for="generoJovenes"><i class="fas fa-venus-mars"></i> Género</label>
                        <select id="generoJovenes" name="generoJovenes">
                            <option value="">Seleccione género</option>
                            <option value="hombre">Hombre</option>
                            <option value="mujer">Mujer</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="nombrePersonaAyuda"><i class="fas fa-user"></i> Nombre de la persona o familia</label>
                        <input type="text" id="nombrePersonaAyuda" name="nombrePersonaAyuda" placeholder="Ingrese nombre completo o apellido de la familia">
                    </div>
                    
                    <div class="form-group">
                        <label for="edadPersonaAyuda"><i class="fas fa-birthday-cake"></i> Edad (si aplica)</label>
                        <input type="number" id="edadPersonaAyuda" name="edadPersonaAyuda" min="0" max="120" placeholder="Ingrese edad">
                    </div>
                    
                    <div class="form-group">
                        <label for="ayudaSolicitada"><i class="fas fa-comment-dots"></i> Ayuda necesaria</label>
                        <textarea id="ayudaSolicitada" name="ayudaSolicitada" placeholder="Describa la ayuda necesaria..."></textarea>
                    </div>
                </div>
                
                <div class="actions">
                    <button type="button" class="generate-btn" onclick="generarInforme()">
                        <i class="fas fa-file-pdf"></i> Generar Informe
                    </button>
                    <button type="button" class="save-btn" onclick="guardarInformacion()">
                        <i class="fas fa-save"></i> Guardar Información
                    </button>
                    <button type="button" class="clear-btn" onclick="limpiarFormulario()">
                        <i class="fas fa-trash-alt"></i> Limpiar Formulario
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Vista previa del informe -->
        <div class="preview-container" id="previewContainer">
            <div class="preview-header">
                <h2>Informe de Consejo de Coordinación Misional</h2>
                <p>Fecha: <span id="previewFecha"></span></p>
            </div>
            
            <div class="preview-section">
                <h3><i class="fas fa-chalkboard-teacher"></i> Persona[s]/Familia[s] en enseñanza</h3>
                <div id="previewPersonasEnsenanza"></div>
            </div>
            
            <div class="preview-section">
                <h3><i class="fas fa-user-plus"></i> Recién conversos</h3>
                <div id="previewRecienConversos"></div>
            </div>
            
            <div class="preview-section">
                <h3><i class="fas fa-user-clock"></i> Menos Activos</h3>
                <div id="previewMenosActivos"></div>
            </div>
            
            <div class="preview-section">
                <h3><i class="fas fa-hands-helping"></i> Ayuda adicional necesaria</h3>
                <div id="previewAyudaAdicional"></div>
            </div>
            
            <div class="preview-footer">
                <p>Informe generado automáticamente por el sistema de Consejo de Coordinación Misional</p>
            </div>
        </div>
    </div>

    <script>
        // Establecer fecha actual por defecto
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fecha').value = today;
        });
        
        // Función para agregar una nueva persona
        function addPersona(containerId) {
            const container = document.getElementById(containerId);
            const personaCount = container.querySelectorAll('.persona-item').length + 1;
            
            let titulo = '';
            let nombreField = '';
            let edadField = '';
            let planesField = '';
            
            if (containerId === 'personasEnsenanza') {
                titulo = `Persona/Familia #${personaCount}`;
                nombreField = 'personaNombre[]';
                edadField = 'personaEdad[]';
                planesField = 'personaPlanes[]';
            } else if (containerId === 'recienConversos') {
                titulo = `Recién convertido #${personaCount}`;
                nombreField = 'recienNombre[]';
                edadField = 'recienEdad[]';
                planesField = 'recienPlanes[]';
            } else if (containerId === 'menosActivos') {
                titulo = `Menos activo #${personaCount}`;
                nombreField = 'activoNombre[]';
                edadField = 'activoEdad[]';
                planesField = 'activoPlanes[]';
            }
            
            const personaHTML = `
                <div class="persona-item">
                    <div class="persona-header">
                        <h4>${titulo}</h4>
                        <button type="button" class="remove-btn" onclick="removePersona(this)"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="form-group">
                        <label>Nombre de la persona o familia</label>
                        <input type="text" name="${nombreField}" placeholder="Ingrese nombre completo" required>
                    </div>
                    <div class="form-group">
                        <label>Edad (si aplica)</label>
                        <input type="number" name="${edadField}" min="0" max="120" placeholder="Ingrese edad">
                    </div>
                    <div class="form-group">
                        <label>Planes para ayudar a la persona/familia</label>
                        <textarea name="${planesField}" placeholder="Describa los planes de apoyo..."></textarea>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', personaHTML);
        }
        
        // Función para eliminar una persona
        function removePersona(button) {
            const personaItem = button.closest('.persona-item');
            if (personaItem) {
                personaItem.remove();
            }
        }
        
        // Mostrar/ocultar subcategoría de jóvenes
        function toggleSubcategoria() {
            const organizacion = document.getElementById('organizacion').value;
            const subcategoria = document.getElementById('subcategoriaJovenes');
            
            if (organizacion === 'jovenes') {
                subcategoria.classList.add('active');
            } else {
                subcategoria.classList.remove('active');
            }
        }
        
        // Limpiar formulario
        function limpiarFormulario() {
            if (confirm('¿Está seguro de que desea limpiar todo el formulario?')) {
                document.getElementById('informeForm').reset();
                document.getElementById('subcategoriaJovenes').classList.remove('active');
                document.getElementById('previewContainer').style.display = 'none';
                
                // Restablecer fecha actual
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('fecha').value = today;
                
                // Limpiar contenedores de personas
                document.getElementById('personasEnsenanza').innerHTML = `
                    <div class="persona-item">
                        <div class="persona-header">
                            <h4>Persona/Familia #1</h4>
                            <button type="button" class="remove-btn" onclick="removePersona(this)"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="form-group">
                            <label>Nombre de la persona o familia</label>
                            <input type="text" name="personaNombre[]" placeholder="Ingrese nombre completo" required>
                        </div>
                        <div class="form-group">
                            <label>Edad (si aplica)</label>
                            <input type="number" name="personaEdad[]" min="0" max="120" placeholder="Ingrese edad">
                        </div>
                        <div class="form-group">
                            <label>Planes para ayudar a la persona/familia</label>
                            <textarea name="personaPlanes[]" placeholder="Describa los planes de apoyo..."></textarea>
                        </div>
                    </div>
                `;
                
                document.getElementById('recienConversos').innerHTML = `
                    <div class="persona-item">
                        <div class="persona-header">
                            <h4>Recién convertido #1</h4>
                            <button type="button" class="remove-btn" onclick="removePersona(this)"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="form-group">
                            <label>Nombre de la persona o familia</label>
                            <input type="text" name="recienNombre[]" placeholder="Ingrese nombre completo" required>
                        </div>
                        <div class="form-group">
                            <label>Edad (si aplica)</label>
                            <input type="number" name="recienEdad[]" min="0" max="120" placeholder="Ingrese edad">
                        </div>
                        <div class="form-group">
                            <label>Planes para ayudar a la persona/familia</label>
                            <textarea name="recienPlanes[]" placeholder="Describa los planes de apoyo..."></textarea>
                        </div>
                    </div>
                `;
                
                document.getElementById('menosActivos').innerHTML = `
                    <div class="persona-item">
                        <div class="persona-header">
                            <h4>Menos activo #1</h4>
                            <button type="button" class="remove-btn" onclick="removePersona(this)"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="form-group">
                            <label>Nombre de la persona o familia</label>
                            <input type="text" name="activoNombre[]" placeholder="Ingrese nombre completo" required>
                        </div>
                        <div class="form-group">
                            <label>Edad (si aplica)</label>
                            <input type="number" name="activoEdad[]" min="0" max="120" placeholder="Ingrese edad">
                        </div>
                        <div class="form-group">
                            <label>Planes para ayudar a la persona/familia</label>
                            <textarea name="activoPlanes[]" placeholder="Describa los planes de apoyo..."></textarea>
                        </div>
                    </div>
                `;
            }
        }
        
        // Guardar información en localStorage
        function guardarInformacion() {
            const formData = new FormData(document.getElementById('informeForm'));
            const data = {};
            
            // Recopilar datos del formulario
            for (let [key, value] of formData.entries()) {
                if (data[key]) {
                    // Si ya existe la clave, convertir en array
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            }
            
            // Guardar en localStorage
            localStorage.setItem('informeMisional', JSON.stringify(data));
            alert('Información guardada correctamente. Podrá continuar más tarde.');
        }
        
        // Cargar información guardada al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            const savedData = localStorage.getItem('informeMisional');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // Cargar datos simples
                Object.keys(data).forEach(key => {
                    const element = document.querySelector(`[name="${key}"]`);
                    if (element && element.type !== 'checkbox' && element.type !== 'radio') {
                        element.value = data[key];
                    }
                });
                
                // Cargar datos de arrays (personas)
                // Ejemplo para personas en enseñanza
                if (data['personaNombre[]']) {
                    const nombres = Array.isArray(data['personaNombre[]']) ? data['personaNombre[]'] : [data['personaNombre[]']];
                    const edades = Array.isArray(data['personaEdad[]']) ? data['personaEdad[]'] : [data['personaEdad[]'] || ''];
                    const planes = Array.isArray(data['personaPlanes[]']) ? data['personaPlanes[]'] : [data['personaPlanes[]'] || ''];
                    
                    // Limpiar contenedor y agregar personas guardadas
                    const container = document.getElementById('personasEnsenanza');
                    container.innerHTML = '';
                    
                    nombres.forEach((nombre, index) => {
                        addPersonaWithValues('personasEnsenanza', nombre, edades[index] || '', planes[index] || '');
                    });
                }
                
                alert('Información guardada cargada correctamente.');
            }
        });
        
        // Función para agregar persona con valores específicos
        function addPersonaWithValues(containerId, nombre, edad, planes) {
            const container = document.getElementById(containerId);
            const personaCount = container.querySelectorAll('.persona-item').length + 1;
            
            let titulo = '';
            let nombreField = '';
            let edadField = '';
            let planesField = '';
            
            if (containerId === 'personasEnsenanza') {
                titulo = `Persona/Familia #${personaCount}`;
                nombreField = 'personaNombre[]';
                edadField = 'personaEdad[]';
                planesField = 'personaPlanes[]';
            } else if (containerId === 'recienConversos') {
                titulo = `Recién convertido #${personaCount}`;
                nombreField = 'recienNombre[]';
                edadField = 'recienEdad[]';
                planesField = 'recienPlanes[]';
            } else if (containerId === 'menosActivos') {
                titulo = `Menos activo #${personaCount}`;
                nombreField = 'activoNombre[]';
                edadField = 'activoEdad[]';
                planesField = 'activoPlanes[]';
            }
            
            const personaHTML = `
                <div class="persona-item">
                    <div class="persona-header">
                        <h4>${titulo}</h4>
                        <button type="button" class="remove-btn" onclick="removePersona(this)"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="form-group">
                        <label>Nombre de la persona o familia</label>
                        <input type="text" name="${nombreField}" placeholder="Ingrese nombre completo" value="${nombre}" required>
                    </div>
                    <div class="form-group">
                        <label>Edad (si aplica)</label>
                        <input type="number" name="${edadField}" min="0" max="120" placeholder="Ingrese edad" value="${edad}">
                    </div>
                    <div class="form-group">
                        <label>Planes para ayudar a la persona/familia</label>
                        <textarea name="${planesField}" placeholder="Describa los planes de apoyo...">${planes}</textarea>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', personaHTML);
        }
        
        // Generar el informe en PDF
        function generarInforme() {
            // Validar formulario
            const form = document.getElementById('informeForm');
            if (!form.checkValidity()) {
                alert('Por favor complete todos los campos requeridos.');
                return;
            }
            
            // Mostrar vista previa
            mostrarVistaPrevia();
            
            // Generar PDF después de un pequeño retraso para asegurar que se renderice la vista previa
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Capturar el contenido de la vista previa
                html2canvas(document.getElementById('previewContainer')).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 190;
                    const pageHeight = 280;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 10;
                    
                    doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    
                    // Agregar páginas adicionales si es necesario
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        doc.addPage();
                        doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    // Guardar el PDF
                    const fecha = document.getElementById('fecha').value;
                    doc.save(`informe_consejo_${fecha}.pdf`);
                });
            }, 500);
        }
        
        // Mostrar vista previa del informe
        function mostrarVistaPrevia() {
            // Fecha
            const fecha = document.getElementById('fecha').value;
            document.getElementById('previewFecha').textContent = new Date(fecha).toLocaleDateString('es-ES');
            
            // Personas en enseñanza
            const personasEnsenanza = document.querySelectorAll('#personasEnsenanza .persona-item');
            const previewPersonasEnsenanza = document.getElementById('previewPersonasEnsenanza');
            previewPersonasEnsenanza.innerHTML = '';
            
            personasEnsenanza.forEach((persona, index) => {
                const nombre = persona.querySelector('input[name="personaNombre[]"]').value;
                const edad = persona.querySelector('input[name="personaEdad[]"]').value;
                const planes = persona.querySelector('textarea[name="personaPlanes[]"]').value;
                
                let edadInfo = '';
                if (edad) {
                    edadInfo = `<p><strong>Edad:</strong> ${edad} años</p>`;
                }
                
                previewPersonasEnsenanza.innerHTML += `
                    <div class="preview-item">
                        <h4>${nombre}</h4>
                        ${edadInfo}
                        <p><strong>Planes:</strong> ${planes || 'No especificado'}</p>
                    </div>
                `;
            });
            
            // Recién conversos
            const recienConversos = document.querySelectorAll('#recienConversos .persona-item');
            const previewRecienConversos = document.getElementById('previewRecienConversos');
            previewRecienConversos.innerHTML = '';
            
            recienConversos.forEach((persona, index) => {
                const nombre = persona.querySelector('input[name="recienNombre[]"]').value;
                const edad = persona.querySelector('input[name="recienEdad[]"]').value;
                const planes = persona.querySelector('textarea[name="recienPlanes[]"]').value;
                
                let edadInfo = '';
                if (edad) {
                    edadInfo = `<p><strong>Edad:</strong> ${edad} años</p>`;
                }
                
                previewRecienConversos.innerHTML += `
                    <div class="preview-item">
                        <h4>${nombre}</h4>
                        ${edadInfo}
                        <p><strong>Planes:</strong> ${planes || 'No especificado'}</p>
                    </div>
                `;
            });
            
            // Menos activos
            const menosActivos = document.querySelectorAll('#menosActivos .persona-item');
            const previewMenosActivos = document.getElementById('previewMenosActivos');
            previewMenosActivos.innerHTML = '';
            
            menosActivos.forEach((persona, index) => {
                const nombre = persona.querySelector('input[name="activoNombre[]"]').value;
                const edad = persona.querySelector('input[name="activoEdad[]"]').value;
                const planes = persona.querySelector('textarea[name="activoPlanes[]"]').value;
                
                previewMenosActivos.innerHTML += `
                    <div class="preview-item">
                        <h4>${nombre} ${edad ? `(${edad} años)` : ''}</h4>
                        <p><strong>Planes:</strong> ${planes || 'No especificado'}</p>
                    </div>
                `;
            });
            
            // Ayuda adicional
            const organizacion = document.getElementById('organizacion').value;
            const generoJovenes = document.getElementById('generoJovenes').value;
            const nombrePersonaAyuda = document.getElementById('nombrePersonaAyuda').value;
            const edadPersonaAyuda = document.getElementById('edadPersonaAyuda').value;
            const ayudaSolicitada = document.getElementById('ayudaSolicitada').value;
            
            let organizacionTexto = '';
            switch(organizacion) {
                case 'primaria': organizacionTexto = 'Primaria (8-11 años)'; break;
                case 'jovenes': 
                    organizacionTexto = `Hombres y Mujeres Jóvenes (12-17 años)${generoJovenes ? ` - ${generoJovenes === 'hombre' ? 'Hombres' : 'Mujeres'}` : ''}`; 
                    break;
                case 'sociedad': organizacionTexto = 'Sociedad de Socorro (18+)'; break;
                case 'cuorum': organizacionTexto = 'Cuórum de Elderes (18+)'; break;
                default: organizacionTexto = 'No especificada';
            }
            
            let personaInfo = '';
            if (nombrePersonaAyuda) {
                personaInfo += `<p><strong>Persona/Familia:</strong> ${nombrePersonaAyuda}</p>`;
                if (edadPersonaAyuda) {
                    personaInfo += `<p><strong>Edad:</strong> ${edadPersonaAyuda} años</p>`;
                }
            }
            
            document.getElementById('previewAyudaAdicional').innerHTML = `
                <div class="preview-item">
                    <p><strong>Organización:</strong> ${organizacionTexto}</p>
                    ${personaInfo}
                    <p><strong>Ayuda solicitada:</strong> ${ayudaSolicitada || 'No especificada'}</p>
                </div>
            `;
            
            // Mostrar contenedor de vista previa
            document.getElementById('previewContainer').style.display = 'block';
            
            // Desplazar hacia la vista previa
            document.getElementById('previewContainer').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
